jobs:
  - name: unit-test
    plan:
    - aggregate:
      - get: source-ci
      - get: bosh-cpi-src
        trigger: true
    - aggregate:
      - task: test-pyvmomi_to_ruby
        file: source-ci/ci/tasks/test-pyvmomi_to_ruby.yml
      - task: unit-test
        file: source-ci/ci/tasks/unit-test.yml

<% each_pool do |pool| -%>
<%= render('partition', pool: pool) %>
<% end -%>

resources:
  - name: pool-7.0-NSXT30
    type: pool
    source:
      uri:          git@gitlab.eng.vmware.com:tas-vcf-vmc-anycloud/vcpi-pool.git
      branch:       master
      pool:         v7.0-nsxt30
      private_key:  ((vcpi-pool_deployment_key))
  - name: source-ci
    type: git
    source:
      uri:         https://github.com/cloudfoundry/bosh-vsphere-cpi-release.git
      branch:      master
      paths:       [ci]
  - name: bosh-cpi-src
    type: git
    source:
      uri:         https://github.com/cloudfoundry/bosh-vsphere-cpi-release.git
      branch:      master
      ignore_paths: [ci]
  - name: stemcell
    type: bosh-io-stemcell
    source:
      name: bosh-vsphere-esxi-ubuntu-trusty-go_agent

